name: diamond
edges:
  - source: data-processing
    target: infer_A
    data:
      source_path: /data/data-processing-output-A
      target_path: /data/infer-A-input
      size_gb: 10
  - source: data-processing
    target: infer_B
    data:
      source_path: /data/data-processing-output-B
      target_path: /data/infer-B-input
      size_gb: 20
  - source: infer_A
    target: eval_A_B
  - source: infer_B
    target: eval_A_B
---
name: data-processing

resources:
  cpus: 2+
  use_spot: true
  any_of:
    - cloud: aws
    - cloud: gcp

setup: |
  echo setup for data-processing
  sleep 20

run: |
  echo data-processing starts
  echo "Hello World!" > /data/data-processing-output-A/world.txt
  echo "Hello World!" > /data/data-processing-output-B/world.txt
  sleep 30
  echo data-processing ends

---
name: infer_A

resources:
  cpus: 2+
  any_of:
    - cloud: aws
    - cloud: gcp

setup: |
  echo setup for infer_A
  sleep 20

run: |
  echo infer_A starts
  cat /data/infer-A-input/world.txt
  sleep 20
  echo infer_A ends

---

name: infer_B

resources:
  cpus: 2+

setup: |
  echo setup for infer_B
  sleep 20

run: |
  echo infer_B starts
  cat /data/infer-B-input/world.txt
  sleep 20
  echo infer_B ends

---

name: eval_A_B

resources:
  cpus: 2+

setup: |
  echo setup for eval
  sleep 20

run: |
  echo eval starts
  sleep 20
  echo eval ends
